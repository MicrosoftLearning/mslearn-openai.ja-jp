---
lab:
  title: Azure OpenAI で独自のデータを使用する
---

# Azure OpenAI で独自のデータを使用する

Azure OpenAI Service を使用すると、基になる LLM のインテリジェンスで独自のデータを使用できます。 独自のデータのみを関連トピックに使用するようにモデルを制限したり、事前トレーニング済みモデルの結果とブレンドしたりすることができます。

この演習には約 **20** 分かかります。

## 開始する前に

Azure OpenAI Service へのアクセスが承認されている Azure サブスクリプションが必要になります。 

- 無料の Azure サブスクリプションにサインアップするには、[https://azure.microsoft.com/free](https://azure.microsoft.com/free) にアクセスしてください。
- Azure OpenAI Service へのアクセスを要求するには、[https://aka.ms/oaiapply](https://aka.ms/oaiapply) にアクセスしてください。

## Azure OpenAI リソースをプロビジョニングする

Azure OpenAI モデルを使用する前に、Azure サブスクリプションに Azure OpenAI リソースをプロビジョニングする必要があります。

1. [Azure Portal](https://portal.azure.com?azure-portal=true) にサインインします。
2. 次の設定で **Azure OpenAI** リソースを作成します。
    - **サブスクリプション**: Azure OpenAI Service のアクセスが承認されている Azure サブスクリプション。
    - **リソース グループ**: ご自分で選択した名前を持つ新しいリソース グループを作成します。
    - **リージョン**: 使用できるリージョンを選択します。
    - **名前**: 任意の一意の名前。
    - **価格レベル**: Standard S0
3. デプロイが完了するまで待ちます。 次に、Azure portal で、デプロイされた Azure OpenAI リソースに移動します。

## モデルをデプロイする

Azure OpenAI とチャットするには、まず、**Azure OpenAI Studio** を介して使用するモデルをデプロイする必要があります。 デプロイが完了したら、モデルをプレイグラウンドで使用し、データを応答の根拠付けに使用します。

1. Azure OpenAI リソースの **[概要]** ページで、 **[探索]** ボタンを使用して、新しいブラウザー タブで Azure OpenAI Studio を開きます。または、[Azure OpenAI Studio](https://oai.azure.com/?azure-portal=true) に直接移動します。
2. Azure OpenAI Studio で、次の設定で新しいデプロイを作成します。
    - **モデル名**: gpt-35-turbo
    - **モデル バージョン**: "既定のバージョンを使用する"**
    - **デプロイ名**: text-turbo

## 独自のデータを追加せずに、通常のチャット動作を確認する

Azure OpenAI を独自のデータに接続する前に、まず、基本モデルが、根拠となるデータなしでクエリに応答する方法を確認します。

1. **[チャット]** プレイグラウンドに移動し、デプロイした `gpt-35-turbo` モデルが **[構成]** ペインで選択されていることを確認します (デプロイしたモデルが 1 つのみの場合、これが既定値になります)。
1. 次のプロンプトを入力して、出力を確認します。

    ```code
    I'd like to take a trip to New York. Where should I stay?
    ```

    ```code
    What are some facts about New York?
    ```

1. 根拠となるデータに含める他の場所 (ロンドン、サンフランシスコなど) についても、観光や滞在場所に関する同様の質問を試します。 地域や近隣地域に関する完全な応答、およびその都市に関する一般的な事実が返されるでしょう。

## チャット プレイグラウンドで独自のデータを接続する

次に、チャット プレイグラウンドに独自のデータを追加して、そのデータを根拠としてどのような応答が返されるかを確認します

1. GitHub から、使用する[データをダウンロード](https://aka.ms/own-data-brochures)します。 提供された `.zip` 内の PDF を抽出します。
1. **[チャット]** プレイグラウンドに移動し、[アシスタントのセットアップ] ペインで [Add your data](独自のデータの追加) を選択します。**
1. **[データ ソースの追加]** を選択し、ドロップダウンから [ファイルのアップロード] を選択します。**
1. ストレージ アカウントと Azure Cognitive Search リソースを作成する必要があります。 ストレージ リソースのドロップダウンで、 **[新しい Azure BLOB ストレージ リソースの作成]** を選択し、次の設定でストレージ アカウントを作成します。 指定されていない設定はすべて、既定値のままにします。

    - **サブスクリプション**: "Azure OpenAI リソースと同じサブスクリプション"**
    - **リソース グループ**: "Azure OpenAI リソースと同じリソース グループ"**
    - **ストレージ アカウント名**: "グローバルに一意の名前を入力します"**
    - **リージョン**: "Azure OpenAI リソースと同じリージョン"**
    - **冗長**: ローカル冗長ストレージ (LRS)

1. リソースが作成されたら、Azure OpenAI Studio に戻り、 **[新しい Azure Cognitive Search リソースの作成]** を選択して次の設定で作成します。 指定されていない設定はすべて、既定値のままにします。

    - **サブスクリプション**: "Azure OpenAI リソースと同じサブスクリプション"**
    - **リソース グループ**: "Azure OpenAI リソースと同じリソース グループ"**
    - **サービス名**: "グローバルに一意の名前を入力します"**
    - **場所**: "Azure OpenAI リソースと同じ場所"**
    - **価格レベル**: Basic

1. 検索リソースがデプロイされるまで待ってから、Azure AI Studio に戻り、ページを更新します。
1. **[データの追加]** で、データ ソースに関する次の値を入力し、 **[次へ]** を選択します。

    - **データ ソースの選択**: ファイルのアップロード
    - **Azure Blob ストレージ リソースの選択**: "作成したストレージ リソースを選択します"**
        - プロンプトが表示されたら CORS を有効にします
    - **Azure Cognitive Search リソースの選択**: "作成した検索リソースを選択します"**
    - **インデックス名の入力**: margiestravel
    - **Add vector search to this search resource (この検索リソースにベクトル検索を追加する)** : オフ
    - **I acknowledge that connecting to an Azure Cognitive Search account will incur usage to my account (Azure Cognitive Search アカウントに接続すると、自分のアカウントに対して使用料が発生することに同意します)** : オン

1. **[ファイルのアップロード]** ページで、ダウンロードした PDF をアップロードし、 **[次へ]** を選択します。
1. **[データ管理]** ページで、ドロップダウンから **[キーワード]** の検索の種類を選択し、 **[次へ]** を選択します。
1. **[レビューと完了]** ページで **[保存して閉じる]** を選択すると、データが追加されます。 これには数分かかる場合があります。その間、ウィンドウを開いたままにしておく必要があります。 完了すると、 **[アシスタントのセットアップ]** ペインで指定したデータ ソース、検索リソース、インデックスが表示されます。

## 独自のデータを根拠とするモデルとチャットする

データを追加したので、前と同じ質問をして、応答がどのように異なるかを確認します。

```code
I'd like to take a trip to New York. Where should I stay?
```

```code
What are some facts about New York?
```

特定のホテルに関する詳細や Margie's Travel への言及、提供された情報の出所への言及など、今度の応答はまったく異なることに気付くでしょう。 応答で一覧表示されている PDF 形式のリファレンスを開くと、ホテルが、モデルによって提示されたものと同じであることがわかります。

根拠となるデータに含まれる他の都市 (ドバイ、ラスベガス、ロンドン、サンフランシスコ) についても質問してみましょう。

> **注**: **[Add your data](独自のデータの追加)** はまだプレビュー段階であり、この機能は必ずしも期待どおりに動作するとは限りません。たとえば、根拠となるデータに含まれていない都市については、提供される参考情報が正しくない場合があります。

## クリーンアップ

Azure OpenAI リソースでの作業が完了したら、[Azure portal](https://portal.azure.com/?azure-portal=true) 内のリソースを必ず削除してください。 これには、ストレージ アカウントと検索リソースも含まれます。これらによって比較的多額のコストが発生する可能性があるため、必ず削除してください。
